{"version":3,"file":"operation.js","sourceRoot":"","sources":["../../../../../src/phoneNumber/lro/reserve/operation.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { operationOptionsToRequestOptionsBase, RequestOptionsBase } from \"@azure/core-http\";\nimport { CanonicalCode } from \"@opentelemetry/api\";\nimport {\n  CreateReservationRequest,\n  CreateReservationOptions,\n  CreatePhoneNumberReservationResponse,\n  CreateReservationResponse\n} from \"../../models\";\nimport { attachHttpResponse } from \"../../../common/mappers\";\nimport { createSpan } from \"../../../common/tracing\";\nimport { PhoneNumberReservation } from \"../../generated/src/models\";\nimport { PhoneNumberAdministration } from \"../../generated/src/phoneNumberRestClient\";\nimport { ReservePhoneNumbersPollOperationState, UpdatePollerOptions } from \"../../lroModels\";\nimport { PhoneNumberReservationPollOperationBase } from \"../phoneNumberPollerBase\";\nimport { isComplete } from \"../utils\";\n\n/**\n * The poll operation for reserving phone numbers.\n */\nexport class ReservePhoneNumbersPollOperation extends PhoneNumberReservationPollOperationBase<\n  ReservePhoneNumbersPollOperationState,\n  PhoneNumberReservation\n> {\n  /**\n   * Initializes an instance of ReservePhoneNumbersPollOperation\n   *\n   * @param {PurchaseReservationPollOperationState} state The state of the poll operation\n   * @param {PhoneNumberAdministration} _client A reference to the generated client used to make requests internally.\n   * @param {OperationOptions} requestOptions Additional options for the underlying requests.\n   */\n  constructor(\n    public state: ReservePhoneNumbersPollOperationState,\n    private _client: PhoneNumberAdministration,\n    private requestOptions: RequestOptionsBase\n  ) {\n    super(state, _client);\n  }\n\n  /**\n   * Starts a search for phone numbers given some constraints such as name or area code. The phone numbers that are\n   * found will then be reserved.\n   *\n   * @param {CreateReservationRequest} reservationRequest Request properties to constraint the search scope.\n   * @param {CreateReservationOptions} options Additional request options.\n   */\n  private async createReservation(\n    reservationRequest: CreateReservationRequest,\n    options: CreateReservationOptions = {}\n  ): Promise<CreatePhoneNumberReservationResponse> {\n    const { name, description, phonePlanIds, areaCode, quantity } = reservationRequest;\n    const { span, updatedOptions } = createSpan(\n      \"PhoneNumberAdministrationClient-createReservation\",\n      options\n    );\n    try {\n      const { searchId, _response } = await this._client.createSearch(\n        {\n          displayName: name,\n          description,\n          phonePlanIds,\n          quantity,\n          areaCode\n        },\n        operationOptionsToRequestOptionsBase(updatedOptions)\n      );\n      return attachHttpResponse<CreateReservationResponse>({ reservationId: searchId }, _response);\n    } catch (e) {\n      span.setStatus({\n        code: CanonicalCode.UNKNOWN,\n        message: e.message\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n\n  /**\n   * Reaches to the service and queries the status of the operation.\n   *\n   * @param {UpdatePollerOptions<ReservePhoneNumbersPollOperationState>} [options={}] Additional options for the poll operation\n   */\n  public async update(\n    options: UpdatePollerOptions<ReservePhoneNumbersPollOperationState> = {}\n  ): Promise<ReservePhoneNumbersPollOperation> {\n    const state = this.state;\n    const { reservationRequest } = state;\n\n    if (options.abortSignal) {\n      this.requestOptions.abortSignal = options.abortSignal;\n    }\n\n    try {\n      if (!state.isStarted) {\n        const { reservationId } = await this.createReservation(\n          reservationRequest,\n          this.requestOptions\n        );\n        state.reservationId = reservationId;\n        state.isStarted = true;\n      }\n\n      if (!state.isCompleted && state.reservationId) {\n        state.result = await this.getReservation(state.reservationId, this.requestOptions);\n        state.isCompleted = isComplete(state.result, \"Reserved\");\n      }\n    } catch (error) {\n      state.error = error;\n      state.isCompleted = true;\n    } finally {\n      return this;\n    }\n  }\n\n  /**\n   * Reaches to the service and cancels the operation, also updating the poll operation.\n   */\n  public async cancel(): Promise<ReservePhoneNumbersPollOperation> {\n    const state = this.state;\n    const { reservationId, options = {} } = state;\n\n    if (reservationId) {\n      await this.cancelReservation(reservationId, options);\n    }\n\n    state.isCancelled = true;\n\n    return this;\n  }\n}\n"]}